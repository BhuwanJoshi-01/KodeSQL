{% extends "admin_base.html" %}

{% block title %}{{ page_title }} - SQL Playground{% endblock %}

{% block admin_content %}
<div class="admin-header">
    <h1 class="admin-title">
        <span class="material-icons">quiz</span>
        Manage Challenges
    </h1>
    <div class="admin-actions">
        <a href="{{ url('challenges:admin_challenge_create') }}" class="admin-btn">
            <span class="material-icons">add</span>
            Create Challenge
        </a>
    </div>
</div>

<div class="admin-card">
    <div class="stats-grid">
        <div class="stat-item">
            <h3>{{ total_challenges }}</h3>
            <p>Total Challenges</p>
        </div>
        <div class="stat-item">
            <h3>{{ challenges.paginator.count }}</h3>
            <p>Filtered Results</p>
        </div>
        <div class="stat-item">
            <h3>{{ challenges|length }}</h3>
            <p>On This Page</p>
        </div>
    </div>
    
    <!-- Filter Form -->
    <form method="get" class="filter-form">
        <div class="filter-group">
            <label for="{{ filter_form.difficulty.id_for_label }}">{{ filter_form.difficulty.label }}</label>
            {{ filter_form.difficulty }}
        </div>
        <div class="filter-group">
            <label for="{{ filter_form.status.id_for_label }}">{{ filter_form.status.label }}</label>
            {{ filter_form.status }}
        </div>
        <div class="filter-group">
            <label for="{{ filter_form.search.id_for_label }}">{{ filter_form.search.label }}</label>
            {{ filter_form.search }}
        </div>
        <div class="filter-group">
            <button type="submit" class="admin-btn secondary">
                <span class="material-icons">search</span>
                Filter
            </button>
            <a href="{{ url('challenges:admin_challenges_list') }}" class="admin-btn secondary">
                <span class="material-icons">clear</span>
                Clear
            </a>
        </div>
    </form>
    
    {% if challenges %}
        <div class="table-responsive">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Difficulty</th>
                        <th>Status</th>
                        <th>Sample Data</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for challenge in challenges %}
                        <tr>
                            <td>
                                <strong>{{ challenge.title }}</strong>
                                <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.25rem;">
                                    {{ challenge.description|striptags|truncate(10, True, "") }}
                                </div>
                            </td>
                            <td>
                                <span class="status-badge difficulty-{{ challenge.difficulty }}">
                                    {{ challenge.get_difficulty_display }}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge {% if challenge.is_active %}status-active{% else %}status-inactive{% endif %}">
                                    {% if challenge.is_active %}Active{% else %}Inactive{% endif %}
                                </span>
                            </td>
                            <td>
                                {% if challenge.sample_data %}
                                    <span class="material-icons" style="color: #28a745;" title="Has Sample Data">attach_file</span>
                                    <span style="font-size: 0.875rem;">{{ challenge.sample_data.name|truncate(20) }}</span>
                                {% else %}
                                    <span style="color: var(--text-muted); font-size: 0.875rem;">No file</span>
                                {% endif %}
                            </td>
                            <td>{{ challenge.created_at.strftime('%b %d, %Y') }}</td>
                            <td>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <a href="{{ url('challenges:admin_challenge_detail', challenge_id=challenge.id) }}" 
                                       class="admin-btn info" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                        <span class="material-icons" style="font-size: 16px;">visibility</span>
                                        View
                                    </a>
                                    <a href="{{ url('challenges:admin_challenge_edit', challenge_id=challenge.id) }}" 
                                       class="admin-btn secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                        <span class="material-icons" style="font-size: 16px;">edit</span>
                                        Edit
                                    </a>
                                    <a href="{{ url('challenges:admin_challenge_delete', challenge_id=challenge.id) }}" 
                                       class="admin-btn danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                                        <span class="material-icons" style="font-size: 16px;">delete</span>
                                        Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if challenges.has_other_pages %}
            <div class="pagination">
                {% if challenges.has_previous %}
                    <a href="?page=1{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">&laquo; First</a>
                    <a href="?page={{ challenges.previous_page_number }}{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Previous</a>
                {% endif %}
                
                <span class="current">
                    Page {{ challenges.number }} of {{ challenges.paginator.num_pages }}
                </span>
                
                {% if challenges.has_next %}
                    <a href="?page={{ challenges.next_page_number }}{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Next</a>
                    <a href="?page={{ challenges.paginator.num_pages }}{% if request.GET.difficulty %}&difficulty={{ request.GET.difficulty }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}">Last &raquo;</a>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <span class="material-icons">quiz</span>
            <h3>No challenges found</h3>
            <p>{% if request.GET.search or request.GET.difficulty or request.GET.status %}No challenges match your current filters.{% else %}Create your first challenge to get started.{% endif %}</p>
            {% if request.GET.search or request.GET.difficulty or request.GET.status %}
                <a href="{{ url('challenges:admin_challenges_list') }}" class="admin-btn secondary">
                    <span class="material-icons">clear</span>
                    Clear Filters
                </a>
            {% endif %}
            <a href="{{ url('challenges:admin_challenge_create') }}" class="admin-btn">
                <span class="material-icons">add</span>
                Create Challenge
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}
