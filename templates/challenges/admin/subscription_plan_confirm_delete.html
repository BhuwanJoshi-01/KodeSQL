{% extends 'admin_base.html' %}
{% load static %}

{% block title %}Delete Subscription Plan - {{ plan.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/courses.css' %}">
{% endblock %}

{% block admin_content %}
<div class="admin-header">
    <div class="tile-wrap">
        <div class="admin-header-content">
            <h1>
                <span class="material-icons">delete</span>
                Delete Subscription Plan
            </h1>
            <div class="admin-actions">
                <a href="{% url 'challenges:admin_subscription_plan_detail' plan.id %}" class="btn-secondary">
                    <span class="material-icons">arrow_back</span>
                    Back to Plan
                </a>
            </div>
        </div>
    </div>
</div>

<div class="tile-wrap">
    <div class="admin-content-grid">
        <div class="admin-content-main">
            <div class="admin-card">
                <div class="card-header">
                    <h3>
                        <span class="material-icons">warning</span>
                        Confirm Deletion
                    </h3>
                </div>
                <div class="card-content">
                    {% if active_subscriptions > 0 %}
                        <div class="alert alert-danger">
                            <div class="alert-icon">
                                <span class="material-icons">error</span>
                            </div>
                            <div class="alert-content">
                                <h4>Cannot Delete Plan</h4>
                                <p>This subscription plan cannot be deleted because it has <strong>{{ active_subscriptions }} active subscription(s)</strong>.</p>
                                <p>To delete this plan, you must first:</p>
                                <ul>
                                    <li>Wait for all active subscriptions to expire, or</li>
                                    <li>Cancel all active subscriptions manually</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <a href="{% url 'challenges:admin_subscription_plan_detail' " class="btn btn-primary"btn-primary">
                                <span class="material-icons">arrow_back</span>
                                Back to Plan Details
                            </a>
                            <a href="{% url 'challenges:admin_subscriptions_list' %}?plan={{ plan.id }}" class="btn-secondary">
                                <span class="material-icons">people</span>
                                View Active Subscriptions
                            </a>
                        </div>
                    {% else %}
                        <div class="delete-confirmation">
                            <div class="warning-message">
                                <div class="warning-icon">
                                    <span class="material-icons">warning</span>
                                </div>
                                <div class="warning-content">
                                    <h4>Are you sure you want to delete this subscription plan?</h4>
                                    <p>This action cannot be undone. The following plan will be permanently deleted:</p>
                                </div>
                            </div>

                            <div class="plan-summary">
                                <div class="plan-info">
                                    <h5>{{ plan.name }}</h5>
                                    <div class="plan-details">
                                        <div class="detail-row">
                                            <span class="label">Duration:</span>
                                            <span class="value">{{ plan.get_duration_display }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="label">Price:</span>
                                            <span class="value">${{ plan.price }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="label">Status:</span>
                                            <span class="value">
                                                {% if plan.is_active %}
                                                    <span class="status-badge active">Active</span>
                                                {% else %}
                                                    <span class="status-badge inactive">Inactive</span>
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="label">Description:</span>
                                            <span class="value">{{ plan.description|truncatechars:100 }}{% if plan.description|length > 100 %}...{% endif %}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="consequences">
                                <h5>What will happen:</h5>
                                <ul>
                                    <li>The subscription plan will be permanently deleted</li>
                                    <li>Users will no longer be able to purchase this plan</li>
                                    <li>Historical subscription data will be preserved</li>
                                    <li>This action cannot be undone</li>
                                </ul>
                            </div>

                            <form method="post" action="{% url 'challenges:admin_subscription_plan_delete' plan.id %}" class="delete-form">
                                {% csrf_token %}
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn-danger" onclick="return confirm('Are you absolutely sure? This action cannot be undone.')">
                                        <span class="material-icons">delete_forever</span>
                                        Yes, Delete Plan
                                    </button>
                                    <a href="{% url 'challenges:admin_subscription_plan_detail' plan.id %}" class="btn-secondary">
                                        <span class="material-icons">cancel</span>
                                        Cancel
                                    </a>
                                </div>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="admin-content-sidebar">
            <div class="admin-card">
                <div class="card-header">
                    <h3>
                        <span class="material-icons">info</span>
                        Important Information
                    </h3>
                </div>
                <div class="card-content">
                    <div class="info-content">
                        <h5>Before Deleting</h5>
                        <p>Make sure you understand the consequences of deleting this subscription plan:</p>
                        
                        <ul>
                            <li><strong>Permanent Action:</strong> Once deleted, the plan cannot be recovered</li>
                            <li><strong>User Impact:</strong> Users can no longer purchase this plan</li>
                            <li><strong>Data Preservation:</strong> Existing subscription records are kept for historical purposes</li>
                        </ul>

                        <h5>Alternative Actions</h5>
                        <p>Instead of deleting, consider:</p>
                        <ul>
                            <li><strong>Deactivate:</strong> Set the plan as inactive to hide it from users</li>
                            <li><strong>Archive:</strong> Keep the plan but mark it as discontinued</li>
                            <li><strong>Modify:</strong> Update the plan details instead of deleting</li>
                        </ul>
                    </div>
                </div>
            </div>

            {% if active_subscriptions > 0 %}
            <div class="admin-card">
                <div class="card-header">
                    <h3>
                        <span class="material-icons">people</span>
                        Active Subscriptions
                    </h3>
                </div>
                <div class="card-content">
                    <div class="subscription-summary">
                        <p>This plan currently has <strong>{{ active_subscriptions }} active subscription(s)</strong>.</p>
                        <p>You must resolve these subscriptions before the plan can be deleted.</p>
                        
                        <div class="actions">
                            <a href="{% url 'challenges:admin_subscriptions_list' %}?plan={{ plan.id }}" class="btn-outline">
                                <span class="material-icons">visibility</span>
                                View Subscriptions
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
